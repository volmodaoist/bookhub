## 数据模型设计

### v1 版本

```python
class Book(Base):
    __tablename__ = "books"

    bid = Column(Integer, primary_key=True, index=True)  # 图书 ID，主键，自增
    title = Column(String, nullable=False)               # 书名（必填）
    author = Column(String, nullable=False)              # 作者（必填）
    isbn = Column(String, unique=True, nullable=False)   # 国际标准书号，唯一（必填）
    stock = Column(Integer, default=0)                   # 库存数量，默认 0
    abstract = Column(String, nullable=True)             # 图书简介（可为空）
    area = Column(String, nullable=True)                 # 所在区域（如 A-Z 区）
    floor = Column(String, nullable=True)                # 所在楼层（如 1F, 2F）
    tags = Column(String, nullable=True)                 # 图书标签（多个标签用逗号分隔，例如：文学,历史）
```

初版设计数据表的时候只有 Books/Users/Orders，其中Books 混杂了图书的静态信息，以及库存的动态信息

这种数据表的涉及存在几处不妥之处：

- 基本不怎么改变的静态数据与高频变动的动态数据放在一起
  - 其中 title, author, isbn, abstract 基本不变，但是 stock 是一个高频变动的数据。
- 图书信息不同于馆藏数据
  - 图书信息一个静态信息，基本不怎么改变
  - 馆藏信息是一个动态信息，用户借阅会改变图书馆的库存量
  - 图书信息与馆藏信息的物理意义不同，收录的图书可包含实体书和电子书，而后者的没有对应的馆藏信息
  
- 不利于扩展
  - 假设校园包含多个不同的校区，每个校区都有自己独立的图书馆，甚至个别校区不止一个图书馆，单独维护一个 stock 变量很难表达多个校区多个图书馆各自的图书情况：
    - 如何查询某个校区某本书的馆藏量？
    - 如果用户通过图书馆X借阅，之后归还于图书馆Y，如何处理?


```python
class User(Base):
    __tablename__ = "users"

    uid = Column(Integer, primary_key=True, autoincrement=True)         # 系统主键 ID
    name = Column(String(100), nullable=False)                          # 姓名
    email = Column(String(50), nullable=True)                           # 邮箱（可为空）
    phone = Column(String(50), nullable=False)                          # 电话

    # 反向引用：该用户的所有借阅订单
    orders = relationship("Order", back_populates="user")
```

此处设计不合理之处在于没有 student_id 学号，直接使用 uid 这个系统主键作为 key

- 两个 key 作用域其实不同：
  - uid 是技术层面的主键
  - student_id 是业务层面的主键
